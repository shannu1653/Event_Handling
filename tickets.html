<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Find My Tickets ‚Äî 3.0</title>

    <!-- Bootstrap for grid + buttons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* ===========================
       Page base + layout
       =========================== */
        :root {
            --accent: #ff5a3c;
            --muted: #6b7280;
            --card-bg: #ffffff;
            --glass: rgba(255, 255, 255, 0.6);
            --shadow: 0 10px 30px rgba(18, 18, 18, 0.06);
        }

        html,
        body {
            height: 100%;
            background: linear-gradient(135deg, #fff7f3 0%, #fffaf6 50%, #f7fbff 100%);
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: #111827;
            margin: 0;
            padding: 0;
        }

        .containerWrap {
            max-width: 1100px;
            margin: 30px auto;
            padding: 20px;
        }

        header.ticketsHeader {
            display: flex;
            gap: 16px;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .brandRow {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .brandBadge {
            background: var(--accent);
            color: white;
            padding: 10px 12px;
            border-radius: 10px;
            font-weight: 700;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pageTitle {
            font-size: 20px;
            font-weight: 700;
        }

        .smallMuted {
            color: var(--muted);
            font-size: 14px;
        }

        /* ===========================
       Summary/top controls
       =========================== */
        .summaryCard {
            display: flex;
            gap: 14px;
            align-items: center;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.7));
            padding: 12px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .summaryInfo {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stat {
            text-align: center;
        }

        .stat h3 {
            margin: 0;
            font-size: 18px;
        }

        .stat p {
            margin: 0;
            color: var(--muted);
            font-size: 13px;
        }

        .actionBtns {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btnPrimary {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(255, 90, 60, 0.15);
        }

        .btnGhost {
            background: transparent;
            border: 1px solid rgba(0, 0, 0, 0.06);
            padding: 8px 12px;
            border-radius: 10px;
        }

        /* ===========================
       Tickets grid
       =========================== */
        .ticketsGrid {
            margin-top: 18px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
        }

        .ticketCard {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform .28s cubic-bezier(.2, .9, .2, 1), box-shadow .28s;
            will-change: transform;
            display: flex;
            flex-direction: column;
        }

        .ticketCard:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 25px 50px rgba(18, 18, 18, 0.09);
        }

        .ticketTop {
            height: 140px;
            display: block;
            width: 100%;
            overflow: hidden;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.02), rgba(0, 0, 0, 0.02));
        }

        .ticketTop img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform .6s ease;
        }

        .ticketCard:hover .ticketTop img {
            transform: scale(1.06);
        }

        .ticketBody {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }

        .ticketTitle {
            font-size: 15px;
            font-weight: 700;
            line-height: 1.2;
        }

        .ticketMeta {
            color: var(--muted);
            font-size: 13px;
        }

        .ticketFooter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-top: 1px dashed rgba(0, 0, 0, 0.04);
            gap: 8px;
        }

        .priceTag {
            background: linear-gradient(90deg, #fff 0, #fff 60%);
            border-radius: 8px;
            padding: 6px 10px;
            font-weight: 700;
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.04);
            font-size: 14px;
        }

        .cardActions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btnTiny {
            padding: 6px 8px;
            font-size: 13px;
            border-radius: 8px;
        }

        /* ===========================
       Empty state
       =========================== */
        .emptyState {
            text-align: center;
            padding: 50px 20px;
            border-radius: 12px;
            background: linear-gradient(180deg, #fff, #fff);
            box-shadow: var(--shadow);
            color: var(--muted);
        }

        /* ===========================
       Small responsive tweaks
       =========================== */
        @media (max-width:720px) {
            .brandBadge {
                padding: 8px 10px;
                font-size: 14px;
            }

            .summaryCard {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        /* ===========================
       Tiny animation helper for removing card
       =========================== */
        .removing {
            animation: removeCard .45s ease forwards;
        }

        @keyframes removeCard {
            from {
                opacity: 1;
                transform: scale(1);
                height: auto;
                margin-bottom: 16px;
            }

            to {
                opacity: 0;
                transform: scale(.96) translateX(40px);
                height: 0;
                margin-bottom: 0;
            }
        }
    </style>
</head>

<body>

    <div class="containerWrap">
        <!-- HEADER -->
        <header class="ticketsHeader">
            <div class="brandRow">
                <div class="brandBadge"><i class="fa-solid fa-ticket"></i> My Tickets</div>
                <div>
                    <div class="pageTitle">Find My Tickets</div>
                    <div class="smallMuted">All your purchased tickets stored locally (browser)</div>
                </div>
            </div>

            <!-- summary + actions -->
            <div class="summaryCard">
                <div class="summaryInfo">
                    <div class="stat">
                        <h3 id="ticketCount">0</h3>
                        <p>Tickets</p>
                    </div>
                    <div style="width:1px; height:36px; background:rgba(0,0,0,0.06); margin:0 10px;"></div>
                    <div class="stat">
                        <h3 id="totalPrice">$0.00</h3>
                        <p>Total</p>
                    </div>
                </div>

                <div style="width:18px"></div>

                <div class="actionBtns">
                    <button id="clearBtn" class="btnGhost btn btn-sm"><i class="fa-solid fa-trash"></i> Clear</button>
                    <button id="checkoutBtn" class="btnPrimary btn btn-sm"><i class="fa-solid fa-credit-card"></i>
                        Checkout</button>

                    <!-- NEW: Go to History -->
                    <a href="history.html" class="btn btnGhost btn-sm">
                        <i class="fa-solid fa-clock-rotate-left"></i> History
                    </a>
                </div>

            </div>
        </header>

        <!-- TICKETS GRID -->
        <main>
            <div id="ticketsGrid" class="ticketsGrid" aria-live="polite">
                <!-- rendered by JS -->
            </div>

            <div id="emptyState" class="emptyState mt-4" style="display:none;">
                <h4>No tickets yet</h4>
                <p>Buy events on the homepage and they will appear here. üéüÔ∏è</p>
                <a href="index.html" class="btn btnPrimary" style="text-decoration:none; color:white;">Browse Events</a>
            </div>
        </main>
    </div>

    <!-- JS logic -->
    <script>
        /************************************************************************
         * Find My Tickets 3.0
         * - Reads localStorage.tickets (array of ticket objects)
         * - Shows cards, count, total price
         * - Delete single ticket + Clear + Checkout (simulated)
         * - Smooth remove animation
         * - Beginner-friendly comments
         ************************************************************************/

        // Utilities
        function $(sel) { return document.querySelector(sel); }
        function $all(sel) { return Array.from(document.querySelectorAll(sel)); }

        // Elements
        const ticketsGrid = $('#ticketsGrid');
        const ticketCountEl = $('#ticketCount');
        const totalPriceEl = $('#totalPrice');
        const emptyState = $('#emptyState');
        const clearBtn = $('#clearBtn');
        const checkoutBtn = $('#checkoutBtn');

        // Load tickets from localStorage
        function loadTicketsRaw() {
            try {
                return JSON.parse(localStorage.getItem('tickets') || '[]');
            } catch (e) {
                // If corrupted, reset
                localStorage.removeItem('tickets');
                return [];
            }
        }

        // Save tickets to localStorage
        function saveTicketsRaw(tickets) {
            localStorage.setItem('tickets', JSON.stringify(tickets));
        }

        // Format numeric value to currency string
        function formatCurrency(n) {
            return (typeof n !== 'number' || isNaN(n)) ? '$0.00'
                : n.toLocaleString(undefined, { style: 'currency', currency: 'USD', minimumFractionDigits: 2 });
        }

        // Parse price string to numeric USD value
        // Accepts examples: "Free", "From $3.00", "$44.52", "Free", "44", "From ‚Çπ200"
        function parsePriceToNumber(priceStr) {
            if (!priceStr) return 0;
            const s = String(priceStr).trim();

            // If "Free" (case-insensitive)
            if (/free/i.test(s)) return 0;

            // Try to find the first number (with decimals) in the string
            const match = s.match(/[\d,.]+/);
            if (!match) return 0;

            // Normalize commas: remove commas, keep dot as decimal marker
            const normalized = match[0].replace(/,/g, '');
            const value = parseFloat(normalized);
            return isNaN(value) ? 0 : value;
        }

        // Render all tickets
        function renderTickets() {
            const tickets = loadTicketsRaw();
            ticketsGrid.innerHTML = ''; // clear

            if (tickets.length === 0) {
                emptyState.style.display = 'block';
                ticketCountEl.innerText = '0';
                totalPriceEl.innerText = formatCurrency(0);
                return;
            } else {
                emptyState.style.display = 'none';
            }

            // Build cards
            tickets.forEach((t, idx) => {
                // Create card element
                const card = document.createElement('article');
                card.className = 'ticketCard';
                card.setAttribute('role', 'article');
                card.innerHTML = `
          <div class="ticketTop">
            <img src="${t.image || 'https://via.placeholder.com/900x600?text=Event'}" alt="${escapeHtml(t.title || 'Event image')}">
          </div>
          <div class="ticketBody">
            <div>
              <div class="ticketTitle">${escapeHtml(t.title || 'Untitled Event')}</div>
              <div class="ticketMeta">${escapeHtml(t.date || '')}</div>
            </div>
            <div style="flex:1"></div>
            <div class="ticketFooter">
              <div>
                <div class="priceTag">${escapeHtml(t.price || 'Free')}</div>
                <div class="smallMuted" style="font-size:12px;margin-top:6px;color:var(--muted)">${escapeHtml(t.ticketId || '')}</div>
              </div>
              <div class="cardActions">
                <button class="btn btn-sm btnGhost btnTiny" data-action="view" aria-label="View">View</button>
                <button class="btn btn-sm btn-danger btnTiny" data-action="delete" aria-label="Delete"><i class="fa-solid fa-trash"></i></button>
              </div>
            </div>
          </div>
        `;

                // Attach to grid
                ticketsGrid.appendChild(card);

                // Wire actions (view opens the original event view popup or a simple alert here)
                const btnView = card.querySelector('[data-action="view"]');
                const btnDelete = card.querySelector('[data-action="delete"]');

                btnView.addEventListener('click', () => {
                    // For now we show a small details modal-like alert (you can link this to your viewEvent)
                    // If you have viewEvent(index) in your main app you can call it via window.viewEventIndex...
                    const details = `
${t.title || 'Untitled'}
${t.date || ''}
Price: ${t.price || 'Free'}
Ticket ID: ${t.ticketId || ''}
Description: ${t.description || '‚Äî'}
          `;
                    alert(details);
                });

                btnDelete.addEventListener('click', () => removeTicket(idx, card));
            });

            // Update stats
            updateSummary();
        }

        // Remove a ticket with animation and update storage
        function removeTicket(index, cardEl) {
            if (!confirm('Remove this ticket from your list?')) return;
            // animate out
            cardEl.classList.add('removing');

            // After animation remove from DOM and storage
            cardEl.addEventListener('animationend', () => {
                const tickets = loadTicketsRaw();
                tickets.splice(index, 1);
                saveTicketsRaw(tickets);
                renderTickets(); // re-render fresh (indexes changed)
            }, { once: true });
        }

        // Clear all tickets
        clearBtn.addEventListener('click', () => {
            if (!confirm('Clear all tickets?')) return;
            localStorage.removeItem('tickets');
            renderTickets();
        });

        // Checkout (simulated)
        checkoutBtn.addEventListener('click', () => {
            const tickets = loadTicketsRaw();
            if (tickets.length === 0) {
                alert('No tickets in cart.');
                return;
            }

            // simulate a checkout flow
            const total = tickets.reduce((sum, t) => sum + parsePriceToNumber(t.price), 0);

            // Very simple confirmation
            const ok = confirm(`Proceed to checkout ‚Äî Total ${formatCurrency(total)}? (This is a simulation)`);
            if (!ok) return;

            // On success we save purchase record (optional) and clear tickets
            // For demo, we'll add a simple purchase history in localStorage.purchaseHistory
            const history = JSON.parse(localStorage.getItem('purchaseHistory') || '[]');
            history.push({
                purchasedAt: new Date().toISOString(),
                items: tickets,
                total: total
            });
            localStorage.setItem('purchaseHistory', JSON.stringify(history));

            // Clear cart
            localStorage.removeItem('tickets');
            renderTickets();

            // Congratulations message
            alert('‚úÖ Purchase simulated ‚Äî tickets moved to purchase history. Enjoy!');
        });

        // Update the numeric summary counters
        function updateSummary() {
            const tickets = loadTicketsRaw();
            ticketCountEl.innerText = tickets.length;

            const total = tickets.reduce((s, t) => s + parsePriceToNumber(t.price), 0);
            totalPriceEl.innerText = formatCurrency(total);
        }

        // Escape HTML small helper (basic)
        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Initial render
        renderTickets();

        // Expose a helper so other pages can navigate here after adding a ticket:
        // Example from main page: localStorage.tickets push -> window.location.href = 'tickets.html';
        window.refreshTicketsPage = renderTickets;

        // Optional: react to storage changes from other tabs
        window.addEventListener('storage', (e) => {
            if (e.key === 'tickets') renderTickets();
        });

    </script>
</body>

</html>